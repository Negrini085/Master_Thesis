# Opening a netCDF file in order to have a grid for plotting
nc <- nc_open("y2011/ITSNOW_SWE_201103.nc")
print(names(nc$dim))
nc_close(nc)
# The purpose of this script is to check if the two methods I used in order to
# compute the monthly map for March 2011 give similar result or not. To do so,
# we will subtract one matrix from the another, hoping to get almost all zero values.
library(ncdf4)
library(ggplot2)
library(matrixStats)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
# Loading swe monthly maps that I will compare
e <- new.env()
load("March2011_map_firstTry.RData", envir = e)
first <- e$appo
e <- new.env()
load("March2011_map_secondTry.RData", envir = e)
second <- e$appo
# Opening a netCDF file in order to have a grid for plotting
nc <- nc_open("y2011/ITSNOW_SWE_201103.nc")
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
nc_close(nc)
# The purpose of this script is to check if the two methods I used in order to
# compute the monthly map for March 2011 give similar result or not. To do so,
# we will subtract one matrix from the another, hoping to get almost all zero values.
library(ncdf4)
library(ggplot2)
library(matrixStats)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
# Loading swe monthly maps that I will compare
e <- new.env()
load("March2011_map_firstTry.RData", envir = e)
first <- e$appo
e <- new.env()
load("March2011_map_secondTry.RData", envir = e)
second <- e$appo
# Opening a netCDF file in order to have a grid for plotting
nc <- nc_open("y2011/ITSNOW_SWE_201103.nc")
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
nc_close(nc)
# Creating grid and variable to plot
diff <- second - first
grid <- expand.grid(lon = lon, lat = lat)
grid$diff <- as.vector(diff)
ggplot(grid, aes(x = lon, y = lat, fill = diff)) +
geom_raster() +
scale_fill_viridis_c(option = "C") +   # Continuous color palette
coord_fixed() +
labs(title = "Difference between methods", x = "Longitude", y = "Latitude", fill = "SWE (mm w.e.)") +     # Titles
theme_minimal()
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("08","09","10","11","12","01","02","03","04","05","06","07")
for(i in 1:length(months)){
if(i<4){
fname = paste0("y", toString(2011), "/ITSNOW_SWE_", toString(y-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(2011), "/ITSNOW_SWE_", toString(y), months[i], ".nc")
}
print(fname)
}
# # Opening netCDF file (using nc_open function) and inspecting its properties
# # As we can see thanks to "class()" function here we are dealing with a netcdf4 object
# f_name = "y2011/ITSNOW_SWE_201103.nc"
# nc <- nc_open(f_name)
# class(nc)
#
# # We want to take a look at its arguments and properties
# # We can inspect a netCDF file content by means of print() or ncatt_get()
# ncatt_get(nc, varid = 0)    # Varid = 0 means that the function will read the whole file
#
# # After that, we want to focus our attention to SWE. To get that variable from the
# # netCDF file, we have to use ncvar_get(). Its usage requires the knowledge of the
# # variable name, which we can get simply by means of names()
# print("Variable names are: ")
# print(names(nc$ndims))
# print("Coordinate names are: ")
# print(names(nc$dim))
#
# # At last, knowing that IT-SNOW netCDF files contain monthly values, we have to
# # chose which day we want to consider (necessary, because we risk to load an excessive
# # amount of data if we don't do so)
# lat_name <- names(nc$dim)[1]
# lon_name <- names(nc$dim)[2]
# val_name <- names(nc$var)[2]
# lat = ncvar_get(nc, lat_name)
# lon = ncvar_get(nc, lon_name)
# swe = ncvar_get(nc, val_name, start = c(1, 1, 4), count = c(-1, -1, 1))
#
# # Here we try to print latitude values, to check if missing values are present
# # Moreover, we will also check coordinates and values dimensions.
# print(paste("Class: ", class(lat), "Dimensions: ", dim(lat)))
# print(lat)
# print(paste("Class: ", class(swe), "Dimensions: ", toString(dim(swe))))
# print(swe)
#
# # We will now make the switch to ggplot2(), in order to produce our snapshot
# # I would like to start by plotting the simple SWE distribution, and only then
# # I will try to add map contours. First step is creating a grid and adding swe values
# grid <- expand.grid(lon = lon, lat = lat)
# grid$swe <- as.vector(swe)
#
# # Second step is creating a plot. The first thing you have to specify is the data
# # you want to plot, then it's just a matter of specifying aesthetic issues
# ggplot(grid, aes(x = lon, y = lat, fill = swe)) +
#   geom_raster() +
#   scale_fill_viridis_c(option = "C") +   # Continuous color palette
#   coord_fixed() +
#   labs(title = "SWE 4 March 2011", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +     # Titles
#   theme_minimal()
#
#
# # It's very important that you close a netCDF file once you are done with it
# # If you don't do so, there is a high chance of data loss.
# nc_close(nc)
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("08","09","10","11","12","01","02","03","04","05","06","07")
for(i in 1:length(months)){
if(i<4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
print(fname)
}
# # Opening netCDF file (using nc_open function) and inspecting its properties
# # As we can see thanks to "class()" function here we are dealing with a netcdf4 object
# f_name = "y2011/ITSNOW_SWE_201103.nc"
# nc <- nc_open(f_name)
# class(nc)
#
# # We want to take a look at its arguments and properties
# # We can inspect a netCDF file content by means of print() or ncatt_get()
# ncatt_get(nc, varid = 0)    # Varid = 0 means that the function will read the whole file
#
# # After that, we want to focus our attention to SWE. To get that variable from the
# # netCDF file, we have to use ncvar_get(). Its usage requires the knowledge of the
# # variable name, which we can get simply by means of names()
# print("Variable names are: ")
# print(names(nc$ndims))
# print("Coordinate names are: ")
# print(names(nc$dim))
#
# # At last, knowing that IT-SNOW netCDF files contain monthly values, we have to
# # chose which day we want to consider (necessary, because we risk to load an excessive
# # amount of data if we don't do so)
# lat_name <- names(nc$dim)[1]
# lon_name <- names(nc$dim)[2]
# val_name <- names(nc$var)[2]
# lat = ncvar_get(nc, lat_name)
# lon = ncvar_get(nc, lon_name)
# swe = ncvar_get(nc, val_name, start = c(1, 1, 4), count = c(-1, -1, 1))
#
# # Here we try to print latitude values, to check if missing values are present
# # Moreover, we will also check coordinates and values dimensions.
# print(paste("Class: ", class(lat), "Dimensions: ", dim(lat)))
# print(lat)
# print(paste("Class: ", class(swe), "Dimensions: ", toString(dim(swe))))
# print(swe)
#
# # We will now make the switch to ggplot2(), in order to produce our snapshot
# # I would like to start by plotting the simple SWE distribution, and only then
# # I will try to add map contours. First step is creating a grid and adding swe values
# grid <- expand.grid(lon = lon, lat = lat)
# grid$swe <- as.vector(swe)
#
# # Second step is creating a plot. The first thing you have to specify is the data
# # you want to plot, then it's just a matter of specifying aesthetic issues
# ggplot(grid, aes(x = lon, y = lat, fill = swe)) +
#   geom_raster() +
#   scale_fill_viridis_c(option = "C") +   # Continuous color palette
#   coord_fixed() +
#   labs(title = "SWE 4 March 2011", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +     # Titles
#   theme_minimal()
#
#
# # It's very important that you close a netCDF file once you are done with it
# # If you don't do so, there is a high chance of data loss.
# nc_close(nc)
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("08","09","10","11","12","01","02","03","04","05","06","07")
for(i in 1:length(months)){
if(i<4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
print(fname)
}
# # Opening netCDF file (using nc_open function) and inspecting its properties
# # As we can see thanks to "class()" function here we are dealing with a netcdf4 object
# f_name = "y2011/ITSNOW_SWE_201103.nc"
# nc <- nc_open(f_name)
# class(nc)
#
# # We want to take a look at its arguments and properties
# # We can inspect a netCDF file content by means of print() or ncatt_get()
# ncatt_get(nc, varid = 0)    # Varid = 0 means that the function will read the whole file
#
# # After that, we want to focus our attention to SWE. To get that variable from the
# # netCDF file, we have to use ncvar_get(). Its usage requires the knowledge of the
# # variable name, which we can get simply by means of names()
# print("Variable names are: ")
# print(names(nc$ndims))
# print("Coordinate names are: ")
# print(names(nc$dim))
#
# # At last, knowing that IT-SNOW netCDF files contain monthly values, we have to
# # chose which day we want to consider (necessary, because we risk to load an excessive
# # amount of data if we don't do so)
# lat_name <- names(nc$dim)[1]
# lon_name <- names(nc$dim)[2]
# val_name <- names(nc$var)[2]
# lat = ncvar_get(nc, lat_name)
# lon = ncvar_get(nc, lon_name)
# swe = ncvar_get(nc, val_name, start = c(1, 1, 4), count = c(-1, -1, 1))
#
# # Here we try to print latitude values, to check if missing values are present
# # Moreover, we will also check coordinates and values dimensions.
# print(paste("Class: ", class(lat), "Dimensions: ", dim(lat)))
# print(lat)
# print(paste("Class: ", class(swe), "Dimensions: ", toString(dim(swe))))
# print(swe)
#
# # We will now make the switch to ggplot2(), in order to produce our snapshot
# # I would like to start by plotting the simple SWE distribution, and only then
# # I will try to add map contours. First step is creating a grid and adding swe values
# grid <- expand.grid(lon = lon, lat = lat)
# grid$swe <- as.vector(swe)
#
# # Second step is creating a plot. The first thing you have to specify is the data
# # you want to plot, then it's just a matter of specifying aesthetic issues
# ggplot(grid, aes(x = lon, y = lat, fill = swe)) +
#   geom_raster() +
#   scale_fill_viridis_c(option = "C") +   # Continuous color palette
#   coord_fixed() +
#   labs(title = "SWE 4 March 2011", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +     # Titles
#   theme_minimal()
#
#
# # It's very important that you close a netCDF file once you are done with it
# # If you don't do so, there is a high chance of data loss.
# nc_close(nc)
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("09","10","11","12","01","02","03","04","05","06","07","08")
for(i in 1:length(months)){
if(i<=4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
print(fname)
}
# # Opening netCDF file (using nc_open function) and inspecting its properties
# # As we can see thanks to "class()" function here we are dealing with a netcdf4 object
# f_name = "y2011/ITSNOW_SWE_201103.nc"
# nc <- nc_open(f_name)
# class(nc)
#
# # We want to take a look at its arguments and properties
# # We can inspect a netCDF file content by means of print() or ncatt_get()
# ncatt_get(nc, varid = 0)    # Varid = 0 means that the function will read the whole file
#
# # After that, we want to focus our attention to SWE. To get that variable from the
# # netCDF file, we have to use ncvar_get(). Its usage requires the knowledge of the
# # variable name, which we can get simply by means of names()
# print("Variable names are: ")
# print(names(nc$ndims))
# print("Coordinate names are: ")
# print(names(nc$dim))
#
# # At last, knowing that IT-SNOW netCDF files contain monthly values, we have to
# # chose which day we want to consider (necessary, because we risk to load an excessive
# # amount of data if we don't do so)
# lat_name <- names(nc$dim)[1]
# lon_name <- names(nc$dim)[2]
# val_name <- names(nc$var)[2]
# lat = ncvar_get(nc, lat_name)
# lon = ncvar_get(nc, lon_name)
# swe = ncvar_get(nc, val_name, start = c(1, 1, 4), count = c(-1, -1, 1))
#
# # Here we try to print latitude values, to check if missing values are present
# # Moreover, we will also check coordinates and values dimensions.
# print(paste("Class: ", class(lat), "Dimensions: ", dim(lat)))
# print(lat)
# print(paste("Class: ", class(swe), "Dimensions: ", toString(dim(swe))))
# print(swe)
#
# # We will now make the switch to ggplot2(), in order to produce our snapshot
# # I would like to start by plotting the simple SWE distribution, and only then
# # I will try to add map contours. First step is creating a grid and adding swe values
# grid <- expand.grid(lon = lon, lat = lat)
# grid$swe <- as.vector(swe)
#
# # Second step is creating a plot. The first thing you have to specify is the data
# # you want to plot, then it's just a matter of specifying aesthetic issues
# ggplot(grid, aes(x = lon, y = lat, fill = swe)) +
#   geom_raster() +
#   scale_fill_viridis_c(option = "C") +   # Continuous color palette
#   coord_fixed() +
#   labs(title = "SWE 4 March 2011", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +     # Titles
#   theme_minimal()
#
#
# # It's very important that you close a netCDF file once you are done with it
# # If you don't do so, there is a high chance of data loss.
# nc_close(nc)
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("09")#,"10","11","12","01","02","03","04","05","06","07","08")
for(i in 1:length(months)){
if(i<=4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
# Opening netCDF file and reading its content
nc <- nc_open(fname)
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
time <- ncvar_get(nc, names(nc$var)[2])
for(t in 1:length(time)){
# Reading SWE and creating grid for plotting phase
swe <- ncvar_get(nc, names(nc$var)[1], start = c(1, 1, t), count = c(-1, -1, 1))
grid <- expand.grid(lon = lon, lat = lat)
grid$swe <- as.vector(swe)
# Plotting map
p <- ggplot(grid, aes(x = lon, y = lat, fill = grid$swe)) +
geom_raster() +
scale_fill_viridis_c(option = "C") +
coor_fixed() +
labs(title = "SWE gif", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +
theme_minimal()
# Creating correct file name in order to use ggsave
if(i<= 4){
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y-1), ".png")
}
else{
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y), ".png")
}
ggsave(fileout, plot = p, width = 8, height = 6, dpi = 300)
}
nc_close(nc)
}
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("09")#,"10","11","12","01","02","03","04","05","06","07","08")
for(i in 1:length(months)){
if(i<=4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
# Opening netCDF file and reading its content
nc <- nc_open(fname)
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
time <- ncvar_get(nc, names(nc$var)[1])
for(t in 1:length(time)){
# Reading SWE and creating grid for plotting phase
swe <- ncvar_get(nc, names(nc$var)[2], start = c(1, 1, t), count = c(-1, -1, 1))
grid <- expand.grid(lon = lon, lat = lat)
grid$swe <- as.vector(swe)
# Plotting map
p <- ggplot(grid, aes(x = lon, y = lat, fill = grid$swe)) +
geom_raster() +
scale_fill_viridis_c(option = "C") +
coor_fixed() +
labs(title = "SWE gif", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +
theme_minimal()
# Creating correct file name in order to use ggsave
if(i<= 4){
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y-1), ".png")
}
else{
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y), ".png")
}
ggsave(fileout, plot = p, width = 8, height = 6, dpi = 300)
}
nc_close(nc)
}
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("09")#,"10","11","12","01","02","03","04","05","06","07","08")
for(i in 1:length(months)){
if(i<=4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
# Opening netCDF file and reading its content
nc <- nc_open(fname)
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
time <- ncvar_get(nc, names(nc$var)[1])
for(t in 1:length(time)){
# Reading SWE and creating grid for plotting phase
swe <- ncvar_get(nc, names(nc$var)[2], start = c(1, 1, t), count = c(-1, -1, 1))
grid <- expand.grid(lon = lon, lat = lat)
grid$swe <- as.vector(swe)
# Plotting map
p <- ggplot(grid, aes(x = lon, y = lat, fill = grid$swe)) +
geom_raster() +
scale_fill_viridis_c(option = "C") +
coor_fixed() +
labs(title = "SWE gif", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +
theme_minimal()
# Creating correct file name in order to use ggsave
if(i<= 4){
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y-1), ".png")
}
else{
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y), ".png")
}
ggsave(fileout, plot = p, width = 8, height = 6, dpi = 300)
}
nc_close(nc)
}
# The main goal of this script is to enable the user to plot SWE single-day snapshots
# To do so, ncdf4 and ggplot2 packages will be used
rm(list = ls())
gc()
library(ncdf4)
library(ggplot2)
setwd("/home/filippo/Desktop/Codicini/Master_Thesis/SnowCover_studies/IT-Snow")
year <- 2011
months <- c("09")#,"10","11","12","01","02","03","04","05","06","07","08")
for(i in 1:length(months)){
if(i<=4){
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year-1), months[i], ".nc")
}
else{
fname = paste0("y", toString(year), "/ITSNOW_SWE_", toString(year), months[i], ".nc")
}
# Opening netCDF file and reading its content
nc <- nc_open(fname)
lat <- ncvar_get(nc, names(nc$dim)[1])
lon <- ncvar_get(nc, names(nc$dim)[2])
time <- ncvar_get(nc, names(nc$var)[1])
for(t in 1:length(time)){
# Reading SWE and creating grid for plotting phase
swe <- ncvar_get(nc, names(nc$var)[2], start = c(1, 1, t), count = c(-1, -1, 1))
grid <- expand.grid(lon = lon, lat = lat)
grid$swe <- as.vector(swe)
# Plotting map
p <- ggplot(grid, aes(x = lon, y = lat, fill = grid$swe)) +
geom_raster() +
scale_fill_viridis_c(option = "C") +
coor_fixed() +
labs(title = "SWE coverage evolution", x = "Latitude", y = "Longitude", fill = "SWE (mm w.e.)") +
theme_minimal()
# Creating correct file name in order to use ggsave
if(i<= 4){
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y-1), ".png")
}
else{
fileout = paste0("Images/Gif/SWE_map_", sprintf("%02d", t), "/", months[i], "/", toString(y), ".png")
}
ggsave(fileout, plot = p, width = 8, height = 6, dpi = 300)
}
nc_close(nc)
}
